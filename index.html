<!DOCTYPE html>
<html>
<head>
<title>Big Fish</title>

<meta charset="utf-8">
<meta name="title=" content="Big Fish">
<meta name="robots" content="index, follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="A simple game: work your way up">
<meta name="keywords" content="big fish, cookie clicker, game, simple game, addictive, addictive game, fish game, fish">
<meta name="theme-color" content="hsl(0, 0%, 90%)">
<meta name="msapplication-navbutton-color" content="hsl(0, 0%, 90%)">
<meta name="apple-mobile-web-app-status-bar-style" content="hsl(0, 0%, 90%)">
<!--<link rel="shortcut icon" href="icon.png">-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

<style>
body, html {
    background-color: #333 !important;
    color: #fff !important;
}

hr {
    border-color: #fff;
}

img, button, br {
	-webkit-user-select: none; /* Safari */
	-moz-user-select: none; /* Firefox */
	-ms-user-select: none; /* IE10+/Edge */
	user-select: none; /* Standard */
}
::-moz-selection {
	background: hsl(0, 0%, 90%) !important;
}
::selection {
	background: hsl(0, 0%, 90%) !important;
}

.nav-tabs .nav-item .nav-link {
    color: #fff;
}
.nav-tabs .nav-item .nav-link.active {
    color: #333;
}
.nav-tabs .nav-item .nav-link:hover {
    background-color: #fff;
    color: #333;
}

.btn {
    border: 2px solid #333;
}

/* snackbar */
#snackbar {
	visibility: hidden;
	padding: 20px;
	position: fixed;
	left: 50%;
	text-align: center;
	bottom: 40px;
	min-width: 250px;
	margin-left: -125px;
	border: 1px solid;
}
#snackbar.show {
	visibility: visible;
	-webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
	animation: fadein 0.5s, fadeout 0.5s 2.5s;
}
@-webkit-keyframes fadein {
	from {bottom: 0; opacity: 0;}
	to {bottom: 40px; opacity: 1;}
}
@keyframes fadein {
	from {bottom: 0; opacity: 0;}
	to {bottom: 40px; opacity: 1;}
}
@-webkit-keyframes fadeout {
	from {bottom: 40px; opacity: 1;}
	to {bottom: 0; opacity: 0;}
}
@keyframes fadeout {
	from {bottom: 40px; opacity: 1;}
	to {bottom: 0; opacity: 0;}
}

@media (max-width: 768px) {

}
</style>

</head>

<body>
<div class="text-center container">
	<br>
	<div class="page-header">
	<h3><i class="fas fa-fish"></i> Big Fish</h3>
	</div>
	<hr>
	<p><i class="fas fa-coins"></i> <span id="num-coin">0</span> Coin (<span id="num-coin-rate">0</span> Coin/s)</p>
	<p><i class="fas fa-square"></i> <span id="num-food">0</span> Food (<span id="num-food-rate">0</span> Food/s)</p>
	<p><i class="fas fa-fish"></i> <span id="num-fish">1</span> Fish (<span id="num-hungry-fish">0</span> Hungry Fish)</p>
	<div class="row">
	    <div class="col-md-6">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#fish" data-toggle="tab" aria-selected="true">Fish</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#achievements" data-toggle="tab" aria-selected="false">Achievements</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="fish" role="tabpanel">
                    <br>
                    <details open>
                        <summary><i class="fas fa-fish"></i> <span id="num-small-fish">1</span> Small Fish (<span id="num-small-fish-hungry">0</span> Hungry)</summary>
                        <p><i class="fas fa-coins"></i> <span id="num-small-fish-coin">1</span> Coin/s (<span id="num-small-fish-coin-rate">0</span> Coin/s total)</p>
                        <p><i class="fas fa-square"></i> <span id="num-small-fish-food">1</span> Food/s (<span id="num-small-fish-food-rate">0</span> Food/s total)</p>
                        <p><i class="fas fa-water"></i> <span id="num-small-fish-space">1</span> Space (<span id="num-small-fish-space-total">1</span> Space total)</p>
                    </details>
                    <hr>
                    <details>
                        <summary><i class="fas fa-fish fa-2x"></i> <span id="num-medium-fish">1</span> Medium Fish (<span id="num-medium-fish-hungry">0</span> Hungry)</summary>
                        <p><i class="fas fa-coins"></i> <span id="num-medium-fish-coin">30</span> Coin/s (<span id="num-medium-fish-coin-rate">0</span> Coin/s total)</p>
                        <p><i class="fas fa-square"></i> <span id="num-medium-fish-food">1</span> Food/s (<span id="num-medium-fish-food-rate">0</span> Food/s total)</p>
                        <p><i class="fas fa-water"></i> <span id="num-medium-fish-space">2</span> Space (<span id="num-medium-fish-space-total">0</span> Space total)</p>
                    </details>
                    <hr>
                    <details>
                        <summary><i class="fas fa-fish fa-3x"></i> <span id="num-big-fish">1</span> Big Fish (<span id="num-big-fish-hungry">0</span> Hungry)</summary>
                        <p><i class="fas fa-coins"></i> <span id="num-big-fish-coin">900</span> Coin/s (<span id="num-big-fish-coin-rate">0</span> Coin/s total)</p>
                        <p><i class="fas fa-square"></i> <span id="num-big-fish-food">1</span> Food/s (<span id="num-big-fish-food-rate">0</span> Food/s total)</p>
                        <p><i class="fas fa-water"></i> <span id="num-big-fish-space">3</span> Space (<span id="num-big-fish-space-total">0</span> Space total)</p>
                    </details>
                    <hr>
                    <details>
                        <summary><i class="fas fa-water"></i> <span id="num-aquarium">1</span> Aquarium</summary>
                        <p><i class="fas fa-water"></i> <span id="num-aquarium-space">100</span> Space (<span id="num-aquarium-space-used">1</span> used / <span id="num-aquarium-space-total">100</span> total)</p>
                    </details>
                </div>
                <div class="tab-pane" id="achievements" role="tabpanel">
                    <br>
                    TODO: Achievements
                </div>
            </div>
	    </div>
	    <div class="col-md-6">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#purchase" data-toggle="tab" aria-selected="true">Purchase</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#unlocks" data-toggle="tab" aria-selected="false">Unlocks</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="purchase" role="tabpanel">
                    <br>
                    <details open>
                        <summary><i class="fas fa-square"></i> Purchase Food:</summary>
                        <div class="btn-group">
                            <button class="btn purchase-food" value="1"><i class="fas fa-square"></i> 10 Food</button>
                            <button class="btn purchase-food" value="10"><i class="fas fa-square"></i> 100 Food</button>
                            <button class="btn purchase-food" value="100"><i class="fas fa-square"></i> 1000 Food</button>
                        </div>
                        <p><i class="fas fa-coins"></i> <span id="num-food-per-cost">10</span> Food costs <span id="num-food-cost">1</span> Coin</p>
                    </details>
                    <hr>
                    <details>
                        <summary><i class="fas fa-fish"></i> Purchase Small Fish:</summary>
                        <div class="btn-group">
                            <button class="btn purchase-small-fish" value="1"><i class="fas fa-fish"></i> 1 Small Fish</button>
                            <button class="btn purchase-small-fish" value="10"><i class="fas fa-fish"></i> 10 Small Fish</button>
                            <button class="btn purchase-small-fish" value="100"><i class="fas fa-fish"></i> 100 Small Fish</button>
                        </div>
                        <p><i class="fas fa-coins"></i> <span id="num-small-fish-per-cost">1</span> Small Fish costs <span id="num-small-fish-cost">20</span> Coin</p>
                    </details>
                    <hr>
                    <details>
                        <summary><i class="fas fa-fish fa-2x"></i> Purchase Medium Fish:</summary>
                        <div class="btn-group">
                            <button class="btn purchase-medium-fish" value="1"><i class="fas fa-fish fa-2x"></i> 1 Medium Fish</button>
                            <button class="btn purchase-medium-fish" value="10"><i class="fas fa-fish fa-2x"></i> 10 Medium Fish</button>
                            <button class="btn purchase-medium-fish" value="100"><i class="fas fa-fish fa-2x"></i> 100 Medium Fish</button>
                        </div>
                        <p><i class="fas fa-coins"></i> <span id="num-medium-fish-per-cost">1</span> Medium Fish costs <span id="num-medium-fish-cost">400</span> Coin</p>
                    </details>
                    <hr>
                    <details>
                        <summary><i class="fas fa-fish fa-3x"></i> Purchase Large Fish:</summary>
                        <div class="btn-group">
                            <button class="btn purchase-large-fish" value="1"><i class="fas fa-fish fa-3x"></i> 1 Large Fish</button>
                            <button class="btn purchase-large-fish" value="10"><i class="fas fa-fish fa-3x"></i> 10 Large Fish</button>
                            <button class="btn purchase-large-fish" value="100"><i class="fas fa-fish fa-3x"></i> 100 Large Fish</button>
                        </div>
                        <p><i class="fas fa-coins"></i> <span id="num-large-fish-per-cost">1</span> Large Fish costs <span id="num-large-fish-cost">8000</span> Coin</p>
                    </details>
                    <hr>
                    <details>
                        <summary><i class="fas fa-water"></i> Purchase Aquarium:</summary>
                        <div class="btn-group">
                            <button class="btn purchase-aquarium" value="1"><i class="fas fa-water"></i> 1 Aquarium</button>
                            <button class="btn purchase-aquarium" value="10"><i class="fas fa-water"></i> 10 Aquarium</button>
                            <button class="btn purchase-aquarium" value="100"><i class="fas fa-water"></i> 100 Aquarium</button>
                        </div>
                        <p><i class="fas fa-coins"></i> <span id="num-aquarium-per-cost">1</span> Aquarium costs <span id="num-aquarium-cost">160000</span> Coin</p>
                    </details>


                </div>
                <div class="tab-pane" id="unlocks" role="tabpanel">
                    <br>
                    TODO: Unlocks
                </div>
            </div>
	        
	    </div>
	</div>
	<hr>
	<div id="snackbar"></div>
</div>

<script>

/* TODO
disable buttons accordingly in updateUI()
no deadlock possible
unlock medium fish after 100 small fish
make aquariums cheaper or more room? sell fish option?
sell fish fixes deadlock and aquarium problem...
should still make aquarium cheaper though...
*/

// Enums
const FOOD = 0;
const SMALL = 1;
const MEDIUM = 2;
const BIG = 3;

// Classes
class Fish {
    constructor(type, coin, space, food) {
        this.type = type;
        this.coin = coin;
        this.space = space;
        this.food = food;
        this.hungry = false;
        this.ticks = 0;
    }
    eat() {
        if(this.food == FOOD) {
            if(num_food < 1) {
                this.hungry = true;
            } else {
                num_food--;
                this.hungry = false;
            }
        } else if(this.food == SMALL) {
            if(small_fish.length < 1) {
                this.hungry = true;
            } else {
                small_fish.pop();
                this.hungry = false;
            }
        } else if(this.food == MEDIUM) {
            if(medium_fish.length < 1) {
                this.hungry = true;
            } else {
                medium_fish.pop();
                this.hungry = false;
            }
        }
    }
    produce() {
        if(!this.hungry) {
            num_coin += this.coin;
        }
    }
}

// Consts
const SMALLFISH = new Fish(SMALL, 1, 1, FOOD);
const MEDIUMFISH = new Fish(MEDIUM, 30, 2, SMALL);
const BIGFISH = new Fish(SMALL, 900, 3, MEDIUM);
const FOOD_COST = 1;
const SMALL_FISH_COST = 20;
const MEDIUM_FISH_COST = 400;
const BIG_FISH_COST = 8000;
const AQUARIUM_COST = 160000;
const AQUARIUM_SPACE = 100;
const FOOD_UNIT = 10;

// Player Vals
let num_coin = 0;
let num_food = 0;
let num_aquarium = 1;
let small_fish = [];
let medium_fish = [];
let big_fish = [];

// Global vars from updateUI()
// so instead of recalcuating them we can use old ones from last tick()
let num_aquarium_space_used;
let num_coin_rate;
let num_hungry_fish;
let num_hungry_small_fish;
let num_hungry_medium_fish;
let num_hungry_big_fish;

// Onload
$(function() {
    window.setInterval(tick, 1000); //tick every s
    window.addEventListener('resize', handleResize);
    
    small_fish[0] = (SMALLFISH);
    
    $('.btn.purchase-food').click(function() {
       let amount = parseInt($(this).val() );
       if(num_coin < FOOD_COST*amount) {
           showSnackbar('Not enough coin');
       } else {
           num_coin -= FOOD_COST*amount;
           num_food += FOOD_UNIT*amount;
       }
       updateUI();
    });
    $('.btn.purchase-small-fish').click(function() {
        let amount = parseInt($(this).val() );
        if(num_coin < SMALL_FISH_COST*amount) {
            showSnackbar('Not enough coin');
        } else if(num_aquarium*AQUARIUM_SPACE < num_aquarium_space_used + (SMALLFISH.space * amount) ) {
            showSnackbar('Not enough space in aquarium');
        } else {
            num_coin -= SMALL_FISH_COST*amount;
            for(let i=0; i<amount; i++) {
                small_fish.push(SMALLFISH);
            }
       }
       updateUI();
    });
    //todo: medium, big fish
    $('.btn.purchase-aquarium').click(function() {
        let amount = parseInt($(this).val() );
        if(num_coin < AQUARIUM_COST*amount) {
            showSnackbar('Not enough coin');
        } else {
            num_coin -= AQUARIUM_COST*amount;
            num_aquarium += amount;
       }
       updateUI();
    });
    
});

// Game Functions
function tick() {
    for(let i=0; i<small_fish.length; i++) {
        small_fish[i].ticks++;
        small_fish[i].produce();
        small_fish[i].eat();
    }
    for(let i=0; i<medium_fish.length; i++) {
        medium_fish[i].ticks++;
        medium_fish[i].produce();
        medium_fish[i].eat();
    }
    for(let i=0; i<big_fish.length; i++) {
        big_fish[i].ticks++;
        big_fish[i].produce();
        big_fish[i].eat();
    }
    updateUI();
}

function updateUI() {
    num_aquarium_space_used = 0;
    num_coin_rate = 0;
    num_hungry_fish = 0;
    
    num_hungry_small_fish = 0;
    num_hungry_medium_fish = 0;
    num_hungry_big_fish = 0;

    let all_fish = small_fish.concat(medium_fish, big_fish);
    for(let i=0; i<all_fish.length; i++) {
        num_aquarium_space_used += all_fish[i].space;
        if(all_fish[i].hungry) {
            num_hungry_fish++;
        } else {
            num_coin_rate += all_fish[i].coin;
        }
    }
    for(let i=0; i<small_fish.length; i++) {
        if(small_fish[i].hungry) {
            num_hungry_small_fish++;
        }
    }
    //todo: medium, big
    
    $('#num-coin').html(num_coin);
    $('#num-food').html(num_food);
    $('#num-fish').html(all_fish.length);
    $('#num-coin-rate').html(num_coin_rate);
    $('#num-food-rate').html(all_fish.length - num_hungry_fish);
    $('#num-hungry-fish').html(num_hungry_fish);
    
    $('#num-small-fish').html(small_fish.length);
    $('#num-small-fish-food-rate').html(small_fish.length - num_hungry_small_fish);
    $('#num-small-fish-coin-rate').html( (small_fish.length - num_hungry_small_fish)*SMALLFISH.coin);
    $('#num-small-fish-space-total').html(small_fish.length*SMALLFISH.space);
    $('#num-hungry-small-fish').html(num_hungry_small_fish);
    //todo: medium, big
    
    $('#num-aquarium').html(num_aquarium);
    $('#num-aquarium-space-total').html(num_aquarium * AQUARIUM_SPACE);
    $('#num-aquarium-space-used').html(num_aquarium_space_used);
    
}

// Util Functions
function showSnackbar(message) {
	$('#snackbar').addClass('show');
	$('#snackbar').html(message);
	// $('#snackbar').css('animation', 'fadein 0.5s, fadeout 0.5s 2.5s');
	setTimeout(function(){ $('#snackbar').removeClass('show') }, 3000);
}
function handleResize() {
    if(window.innerWidth <= 1024) {
        $('.btn-group').addClass('btn-group-vertical').removeClass('btn-group');
    } else {
        $('.btn-group-vertical').addClass('btn-group').removeClass('btn-group-vertical');
    }
}

</script>

</body>
</html>
